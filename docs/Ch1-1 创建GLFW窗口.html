

<!DOCTYPE html>
<html class="writer-html5" lang="chs" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Ch1-1 创建GLFW窗口 &mdash; EasyVulkan</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Ch1-2 创建Vk实例与逻辑设备" href="Ch1-2%20%E5%88%9B%E5%BB%BAVk%E5%AE%9E%E4%BE%8B%E4%B8%8E%E9%80%BB%E8%BE%91%E8%AE%BE%E5%A4%87.html" />
    <link rel="prev" title="Ch1-0 准备工作" href="Ch1-0%20%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> EasyVulkan
          

          
            
            <img src="_static/logo1.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">第一章 从零到交换链</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Ch1-0%20%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C.html">Ch1-0 准备工作</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Ch1-1 创建GLFW窗口</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">包含并链接必要的文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">创建窗口</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">试着运行一下吧！</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Ch1-2%20%E5%88%9B%E5%BB%BAVk%E5%AE%9E%E4%BE%8B%E4%B8%8E%E9%80%BB%E8%BE%91%E8%AE%BE%E5%A4%87.html">Ch1-2 创建Vk实例与逻辑设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ch1-3%20%E5%88%9B%E5%BB%BA%E4%BA%A4%E6%8D%A2%E9%93%BE.html">Ch1-3 创建交换链</a></li>
</ul>
<p class="caption"><span class="caption-text">第二章 基础绘制</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Ch2-1%20%E5%88%9B%E5%BB%BA%E6%B8%B2%E6%9F%93%E9%80%9A%E9%81%93.html">Ch2-1 创建渲染通道</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ch2-2%20%E5%90%8C%E6%AD%A5%E5%8E%9F%E8%AF%AD%E7%AE%80%E4%BB%8B.html">Ch2-2 同步原语简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ch2-3%20%E5%A4%A9%E5%93%AA%EF%BC%8C%E6%98%AF%E4%B8%89%E8%A7%92%E5%BD%A2.html">Ch2-3 天哪，是三角形</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ch2-4%20%E5%8D%B3%E6%97%B6%E5%B8%A7%E4%B8%8E%E9%98%9F%E5%88%97%E6%89%80%E6%9C%89%E6%9D%83%E8%BD%AC%E7%A7%BB.html">Ch2-4 即时帧与队列所有权转移</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">EasyVulkan</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Ch1-1 创建GLFW窗口</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ch1-1-glfw">
<h1>Ch1-1 创建GLFW窗口<a class="headerlink" href="#ch1-1-glfw" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2>包含并链接必要的文件<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">在一切开始之前，来创建一个用于包含各种库的头文件，名称随你喜欢，我就决定叫它 <span class="str">EasyVKStart.h</span> 。</div>
<div class="line">然后加入以下代码：</div>
</div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#pragma once</span>
<span class="c1">//C++标准库的内容</span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sstream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>
<span class="cp">#define _USE_MATH_DEFINES</span>
<span class="cp">#include</span> <span class="cpf">&lt;math.h&gt;</span><span class="cp"></span>

<span class="c1">//GLM</span>
<span class="cp">#define  GLM_FORCE_DEPTH_ZERO_TO_ONE</span>
<span class="cp">#include</span> <span class="cpf">&lt;glm.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;gtc/matrix_transform.hpp&gt;</span><span class="cp"></span>

<span class="c1">//stb_image.h</span>
<span class="cp">#include</span> <span class="cpf">&lt;stb_image.h&gt;</span><span class="cp"></span>

<span class="c1">//Vulkan</span>
<span class="cp">#include</span> <span class="cpf">&lt;vulkan/vulkan.h&gt;</span><span class="cp"></span>
<span class="cp">#pragma comment(lib, &quot;vulkan-1.lib&quot;)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>宏 <span class="macro">_USE_MATH_DEFINES</span> 可以让你使用圆周率 <span class="macro">M_PI</span> ，或者你也可以使用 <code class="docutils literal notranslate"><span class="pre">glm::pi&lt;float&gt;()</span></code> ，不过我觉得 <span class="macro">M_PI</span> 省事些。</p></li>
<li><p>GLM本为是OpenGL设计的，在OpenGL中，NDC（标准化设备坐标系）的深度范围为[-1, 1]，而Vulkan中这个范围为[0, 1]，因此我们必须用宏 <span class="macro">GLM_FORCE_DEPTH_ZERO_TO_ONE</span> 来指定深度范围，这样才能获得正确的投影矩阵（如果你从没有学习过计算机图形学，上述内容对你来说可能会过于跳跃，我会在之后的篇章中给出更详细的解释，目前就放心照抄吧）。</p></li>
</ul>
<div class="line-block">
<div class="line">由于你以后可能会想要将你的程序移植到其他平台，出于通用性的考虑，GLFW相关的内容会被单独拿出来。</div>
</div>
<div class="line-block">
<div class="line">接着创建 <span class="str">VKBase.h</span> ，并在其中包含 <span class="str">EasyVKStart.h</span> 。</div>
<div class="line">这个文件会用来写Vulkan相关的基本内容。</div>
</div>
<div class="line-block">
<div class="line">最后创建一个 <span class="str">GlfwClientGeneral.hpp</span> 。</div>
<div class="line">顾名思义，这个文件用来写一些Glfw客户端的通用内容。</div>
<div class="line">加入以下代码：</div>
</div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;VKBase.h&quot;</span><span class="cp"></span>
<span class="cp">#define GLFW_INCLUDE_VULKAN</span>
<span class="cp">#include</span> <span class="cpf">&lt;GLFW/glfw3.h&gt;</span><span class="cp"></span>
<span class="cp">#pragma comment(lib, &quot;glfw3.lib&quot;)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>要将GLFW用于Vulkan，必须在包含GLFW之前，定义 <span class="macro">GLFW_INCLUDE_VULKAN</span> 宏。</p></li>
</ul>
<div class="line-block">
<div class="line">以上代码全部抄完之后，如果VS提示你有任何文件打不开，检查一下你的附加包含目录和附加库目录。</div>
</div>
</div>
<div class="section" id="id2">
<h2>创建窗口<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">在  <span class="str">GlfwClientGeneral.hpp</span> 添加以下变量：</div>
</div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">//全局变量自动初始化为NULL，不用赋初值也行</span>
<span class="n">GLFWwindow</span><span class="o">*</span> <span class="n">pWindow</span><span class="p">;</span>
<span class="c1">//窗口标题</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">windowTitle</span> <span class="o">=</span> <span class="s">&quot;EasyVK&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">接着我们来写两个函数：</div>
</div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="nf">InitializeWindow</span><span class="p">(</span><span class="n">VkExtent2D</span> <span class="n">windowSize</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">resizable</span> <span class="o">=</span> <span class="nb">true</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">limit_framerate</span> <span class="o">=</span> <span class="nb">true</span><span class="p">)</span> <span class="p">{}</span>
<span class="kt">void</span> <span class="nf">TerminateWindow</span><span class="p">()</span> <span class="p">{}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">第一个函数，用于初始化窗口，我打算让它在初始话成功时返回 <span class="kw">true</span> ，否则返回 <span class="kw">false</span> 。</div>
<div class="line">参数1：窗口大小， <span class="type">VkExtent2D</span> 类型，这个结构体类型由两个 <span class="type">uint32_t</span> 变量构成。</div>
<div class="line">参数2：窗口是否可拉伸。</div>
<div class="line">参数3：是否限制帧数，使帧数与屏幕刷新率一致。我们暂时不会使用这个参数，先写在这里。</div>
<div class="line">返回值：初始化成功时返回 <span class="kw">true</span> 。</div>
</div>
<div class="line-block">
<div class="line">第二个函数，用于终止窗口时，清理GLFW。</div>
</div>
<div class="line-block">
<div class="line">函数的内容如下：</div>
</div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="nf">InitializeWindow</span><span class="p">(</span><span class="n">VkExtent2D</span> <span class="n">windowSize</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">resizable</span> <span class="o">=</span> <span class="nb">true</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">limit_framerate</span> <span class="o">=</span> <span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//用glfwInit()初始化窗口，若执行失败，返回0</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">glfwInit</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">glfwWindowHint</span><span class="p">(</span><span class="n">GLFW_CLIENT_API</span><span class="p">,</span> <span class="n">GLFW_NO_API</span><span class="p">);</span>
    <span class="n">glfwWindowHint</span><span class="p">(</span><span class="n">GLFW_RESIZABLE</span><span class="p">,</span> <span class="n">resizable</span><span class="p">);</span>
    <span class="cm">/*待填充*/</span>
    <span class="n">pWindow</span> <span class="o">=</span> <span class="n">glfwCreateWindow</span><span class="p">(</span><span class="n">windowSize</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">.</span><span class="n">height</span><span class="p">,</span> <span class="n">windowTitle</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">);</span><span class="c1">//若执行失败，返回NULL</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pWindow</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;[ InitializeWindow ]</span><span class="se">\n</span><span class="s">Failed to create a glfw window!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
        <span class="n">glfwTerminate</span><span class="p">();</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="cm">/*待填充*/</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">TerminateWindow</span><span class="p">()</span> <span class="p">{</span>
    <span class="cm">/*待填充*/</span>
    <span class="n">glfwTerminate</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>在创建窗口前，必须调用 <code class="docutils literal notranslate"><span class="pre">glfwWindowHint(GLFW_CLIENT_API,</span> <span class="pre">GLFW_NO_API);</span></code> ，GLFW同GLM一样最初是为OpenGL设计的，<span class="macro">GLFW_CLIENT_API</span> 的默认设置是 <span class="macro">GLFW_OPENGL_API</span> ，这种情况下，GLFW会在创建窗口时创建OpenGL的上下文，这对于Vulkan而言是多余的，所以必须先调用上述语句以向GLFW说明不需要OpenGL的API。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">glfwCreateWindow</span></code> 的第四个参数用于指定全屏模式的显示器，若为 <span class="kw">nullptr</span> ，则使用窗口模式。如果你日后想使用全屏模式，使用 <code class="docutils literal notranslate"><span class="pre">glfwGetPrimaryMonitor</span></code> 来获取主显示器。第五个参数可传入一个其它窗口的handle，用于与其他窗口分享内容。</p></li>
</ul>
<div class="line-block">
<div class="line">这段代码应该无需太多说明。</div>
<div class="line">代码中留有很多待填充的部分，在接下来两节中，我们还会回过头来向其中添加内容。</div>
</div>
<div class="line-block">
<div class="line">下面是一个用于在标题上显示帧率的函数，我并不打算解释它，这纯粹是C++相关的内容：</div>
</div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">TitleFps</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">static</span> <span class="kt">double</span> <span class="n">time0</span> <span class="o">=</span> <span class="n">glfwGetTime</span><span class="p">();</span>
    <span class="k">static</span> <span class="kt">double</span> <span class="n">time1</span><span class="p">;</span>
    <span class="k">static</span> <span class="kt">double</span> <span class="n">dt</span><span class="p">;</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">dframe</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">stringstream</span> <span class="n">info</span><span class="p">;</span>
    <span class="n">time1</span> <span class="o">=</span> <span class="n">glfwGetTime</span><span class="p">();</span>
    <span class="n">dframe</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">dt</span> <span class="o">=</span> <span class="n">time1</span> <span class="o">-</span> <span class="n">time0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">info</span><span class="p">.</span><span class="n">precision</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">info</span> <span class="o">&lt;&lt;</span> <span class="n">windowTitle</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;    &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">fixed</span> <span class="o">&lt;&lt;</span> <span class="n">dframe</span> <span class="o">/</span> <span class="n">dt</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; FPS&quot;</span><span class="p">;</span>
        <span class="n">glfwSetWindowTitle</span><span class="p">(</span><span class="n">pWindow</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">str</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
        <span class="n">info</span><span class="p">.</span><span class="n">str</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
        <span class="n">time0</span> <span class="o">=</span> <span class="n">time1</span><span class="p">;</span>
        <span class="n">dframe</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2>试着运行一下吧！<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;GlfwClientGeneral.hpp&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">InitializeWindow</span><span class="p">({</span><span class="mi">1280</span><span class="p">,</span><span class="mi">720</span><span class="p">}))</span>
        <span class="k">return</span> <span class="mi">-1</span><span class="p">;</span><span class="c1">//来个你讨厌的返回值，不讨厌的也行，总之不该是0</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">glfwWindowShouldClose</span><span class="p">(</span><span class="n">pWindow</span><span class="p">))</span><span class="c1">//若glfwWindowShouldClose返回true，说明应该关闭窗口</span>
    <span class="p">{</span>
        <span class="n">TitleFps</span><span class="p">();</span>
        <span class="cm">/*渲染及操作过程，待填充*/</span>
        <span class="n">glfwPollEvents</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">TerminateWindow</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">glfwPollEvents</span></code> 用于处理glfw相关的事件，比如回调函数，相关细节在日后使用回调函数时再做解释。</p></li>
</ul>
<div class="line-block">
<div class="line">如果你看到了一个全白的窗口，并且帧率还炸了，那就算是一切顺利！</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="Ch1-2%20%E5%88%9B%E5%BB%BAVk%E5%AE%9E%E4%BE%8B%E4%B8%8E%E9%80%BB%E8%BE%91%E8%AE%BE%E5%A4%87.html" class="btn btn-neutral float-right" title="Ch1-2 创建Vk实例与逻辑设备" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="Ch1-0%20%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C.html" class="btn btn-neutral float-left" title="Ch1-0 准备工作" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Qiao Wu.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>